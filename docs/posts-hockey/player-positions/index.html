<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-09-30">

<title>Drydan’s Portfolio - Correcting Player Positions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../posts-hockey/index.html">Hockey Analytics</a></li><li class="breadcrumb-item"><a href="../../posts-hockey/player-positions/index.html">Player Positions</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/pfp.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../posts-hockey/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hockey Analytics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts-hockey/player-positions/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Player Positions</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../posts-hockey/prospect-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prospect Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts-hockey/prospect-models/part-1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 1</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts-misc/yachtdice/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Yacht Dice</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../posts-misc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random Stuff</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts-misc/pipelines/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Partitioning a Pipeline</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Correcting Player Positions</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 30, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>NHL clubs will commonly ice a roster consisting of 18 skaters; 4 lines from 12 forwards <strong>F</strong> and 3 pairs of defenders <strong>D</strong>. A Center <strong>C</strong>, Left Wing <strong>LW</strong>, and Right Wing <strong>RW</strong> form a line. Left Defence <strong>LD</strong> and Right Defence <strong>RD</strong> form a pair. During the even strength portions of a game a team will have 5 skaters on the ice. Predominantly one from each position. While some teams opt to tinker with this set up, we expect the total number of C, LW and RW games played to be balanced. For the 2021/2022 regular season we see this is not the case.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Position</th>
<th style="text-align: left;">Counts</th>
<th style="text-align: left;">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: left;">15903</td>
<td style="text-align: left;">0.336871</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">15794</td>
<td style="text-align: left;">0.334562</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LW</td>
<td style="text-align: left;">9096</td>
<td style="text-align: left;">0.192679</td>
</tr>
<tr class="even">
<td style="text-align: left;">RW</td>
<td style="text-align: left;">6415</td>
<td style="text-align: left;">0.135888</td>
</tr>
</tbody>
</table>
<p>Positions are hardly ever updated once a player joins the league. This leads to some untrustworthy situations. Consider the game between the Ducks and Hawks on March 23rd 2022 (gameId: 2021021018). By the submitted roster sheet, Anaheim played with 1 left wing, 1 right wing and a cast of 10 centers. On top of that, the league doesn’t distinguish between left and right defenders. It is commonly brought into question how well a defender fairs playing on their off hand, or how shallow the league’s RD depth is. Corrected position labels can settle these questions and other roster considerations. Our goal is to assigned one of the five positions to each skater observed in each game for the 2021/2022 regular season.</p>
<section id="data" class="level1">
<h1>Data</h1>
<p>The National Hockey League recorded the following information for every game in the 2021/2022 season:</p>
<ul>
<li><strong>Players</strong>: Who played, for what team and at what position.</li>
<li><strong>Events</strong>: A list of events that occurred. Who was involved, when it happened and the integer coordinates where it took place. Note the following agent descriptors derived from the event type in bracket:
<ul>
<li>Faceoff (Faceoff)</li>
<li>Shooter (Missed Shot, Blocked Shot, Shot, Goal)</li>
<li>Hitter (Hit)</li>
<li>Hittee (Hit)</li>
<li>Giveaway (Giveaway)</li>
<li>Takeaway (Takeaway)</li>
<li>Blocker (Blocked Shot)</li>
</ul></li>
<li><strong>Shifts</strong>: Who was on the ice for each second of the game.</li>
</ul>
<p><img src="images/rink_dims.jpg" class="img-fluid"> <em>x, y axes for event coordinates. From a players point of view the opposition’s net is always placed on the positive side of the x-axis.</em></p>
<p><img src="images/initial_heatmaps.jpg" class="img-fluid"> <em>Rates per sixty minutes for each position in the 2021/2022 season. Contour plots inspired by at IneffectiveMath on twitter</em></p>
<p><img src="images/initial_faceoff_rates.jpg" class="img-fluid"></p>
<p><img src="images/shift_chart.jpg" class="img-fluid"> <em>Tampa Bay’s shift data for the opening game. (gameId: 2021020001)</em></p>
</section>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<p>Instead of clustering all positions at once, we take a top-down hierarchical approach. First skaters are partitioned into forwards and defenders. Then defenders into LD and RD. Then forwards into centers and wingers, and finally wingers into LW and RW.</p>
<section id="forwards-vs.-defenders" class="level2">
<h2 class="anchored" data-anchor-id="forwards-vs.-defenders">Forwards vs.&nbsp;Defenders</h2>
<p>Define the n by n matrix <span class="math inline">\(\Delta\)</span> whose <span class="math inline">\((i, j)\)</span>-th entry corresponds to the number of seconds teammates <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> shared on the ice at even strength in a game. The diagonal entries refer to each player’s total ice time. <span class="math inline">\(\Delta\)</span> can be constructed using the shift data. Let <span class="math inline">\(B\)</span> be the binary matrix obtained from the shift chart (refer to above image), then <span class="math inline">\(\Delta=BB^T\)</span>. From <span class="math inline">\(\Delta\)</span>, we compute <span class="math inline">\(\delta\)</span> by dividing each row by its diagonal entry, so each entry refers to the proportion of a player’s time spent with another. For convenience we set the diagonal elements of <span class="math inline">\(\delta\)</span> to zero. Each player is always accompanied by 4 teammates so every row will sum to 4. Following this thought, consider just the columns corresponding to defenders, <span class="math inline">\(\delta^D\)</span>. The sum of a forward’s row will be very close to 2; and very close to 1 for a defender. Then the binary vector <span class="math inline">\(x\)</span> which minimizes $<em>{i=1}^{n} | 2-x_i-^D</em>{i}x | $ exhibits our F/D labels (<span class="math inline">\(x_i = 1\)</span> indicating the skater is a defender). I’ve opted to solve this heuristically, via a steepest ascent local search. Neighbourhoods are defined by at most 2 label mutations from the current candidate solution. While the search is robust to choice of starting location, the provided D and F labels are quite reliable.</p>
<p><img src="images/toi_matrix.jpg" class="img-fluid"> <em>Tampa Bay’s shift data for the opening game of the 2021/2022 season presented in matrix form</em></p>
<p>72 instances required swapping defenders to forwards, none in the other direction. One was the result of Robert Burtuzzo moving from D to F after the first period - caught with a row sum near 1.6. Which prompts the question, how will we handle mid game role changes? For simplicity, and issues detailed ahead, we restrict the problem to one label per player in each game.</p>
</section>
<section id="left-vs.-right-defenders" class="level2">
<h2 class="anchored" data-anchor-id="left-vs.-right-defenders">Left vs.&nbsp;Right Defenders</h2>
<p>We proceed in a similar fashion to classical expectation-maximization algorithms for mixture models. EM is an iterative algorithm that is useful for handling missing data. While defender labels are truly missing, the forwards are so messed up it’s in our best interest to treat them so.</p>
<p>Defenders are assigned an initial label using a biased coin, 51% in favour of whichever side of the <span class="math inline">\(y = 0\)</span> line they appeared more often on in the game. This gentle nudge is only necessary to avoid any manual aliasing afterwards. The algorithm is described below in detail. In the next section we will adjust it to cluster the forwards.</p>
<section id="step-1.-naive-bayes-classifier" class="level3">
<h3 class="anchored" data-anchor-id="step-1.-naive-bayes-classifier">Step 1. Naive Bayes Classifier</h3>
<p>Let <span class="math inline">\(x_{ij}\)</span> be a vector encoding the counts of each action <span class="math inline">\(a\)</span> at each coordinate <span class="math inline">\((x,y)\)</span> conducted by player <span class="math inline">\(i\)</span> in game <span class="math inline">\(j\)</span>. For example, in the <span class="math inline">\(j\)</span>-th game of the season, player <span class="math inline">\(i\)</span> recorded one shot at center ice, thus <span class="math inline">\(x_{ijk}=1\)</span> where <span class="math inline">\(k=(\text{Shooter},(0,0))\)</span> otherwise 0. We can think of each <span class="math inline">\(x_{ijk}\)</span> as generated independently from a poisson distribution with mean <span class="math inline">\(n_{ij}\theta_{pk}\)</span> where <span class="math inline">\(p\)</span> identifies the player’s position. Parameter <span class="math inline">\(\theta_{pk}\)</span> defines the <em>rate</em> at which <span class="math inline">\(k\)</span> occurs per 60 minutes. <span class="math inline">\(n_{ij}\)</span> is the constant <em>exposure</em> or player <span class="math inline">\(i\)</span>’s ice time in game <span class="math inline">\(j\)</span> divided by 60 minutes. Then we can model the entire population of defenders as a multivariate poisson mixture with two components for LD and RD.</p>
<p>The conditional likelihood of <span class="math inline">\(x_{ij}\)</span> given it has label LD is:</p>
<p><span class="math display">\[f(x_{ij} | p=LD) = \prod_{k=1}^K \frac{(n_{ij}\theta_{LD,k})^{x_{ijk}}e^{-n_{ij}\theta_{LD,k}}}{x_{ijk}!}\]</span></p>
<p>Following bayes rule the posterior likelihood is:</p>
<p><span class="math display">\[f(LD | x_{i,j}) \propto f(LD) f(x_{ij} | LD)\]</span></p>
<p>where <span class="math inline">\(f(LD)\)</span> is the prior probability. Prior to any available information, both positions are considered to be equally likely, so <span class="math inline">\(f(RD) = f(LD) = .5\)</span>.</p>
<p>Finally, the log posterior odds of the two positions is:</p>
<p><span class="math display">\[
\begin{aligned}
\alpha_{i,j} &amp;= \log \frac{f(LD | x_{i,j})}{f(RD | x_{i,j})} \\
&amp;= \sum x_{ijk} \log \frac{\theta_{LD,k}}{\theta_{RD,k}} + n_{i,j} \sum(\theta_{RD,k} - \theta_{LD,k})\\
\end{aligned}
\]</span></p>
<p>which determines membership for each sub-population. A positive <span class="math inline">\(\alpha_{i,j}\)</span> means the player is more likely to be LD.</p>
<p>The log odds require estimating the rate parameters, which in itself calls for existing labels. A typical solution using EM tumbles between the two calculations, with each update hopefully bringing us closer to convergence. At this point we’ve only utilized event data. A satisfying solution will pair both event and shift sources, and we address that in step 2.</p>
</section>
<section id="estimating-the-rate-parameters" class="level3">
<h3 class="anchored" data-anchor-id="estimating-the-rate-parameters">Estimating the rate parameters</h3>
<p>It can be helpful to visualize the <span class="math inline">\(\theta_{p,k}\)</span>’s on a set of grids for each action, seen previously with the contour plots.</p>
<ol type="1">
<li>For each position and action store the total counts in matrix <span class="math inline">\(M_p\)</span>, whose rows and columns coincide with the (x,y) coordinates.</li>
</ol>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>Faceoffs are omitted for defenders. None were recorded, nor do we except them to hold any information for the position.</p>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>Add the matrix corresponding to its mirrored position flipped along the <span class="math inline">\(y=0\)</span> entries to <span class="math inline">\(M_p\)</span>. Add corresponding total exposure times <span class="math inline">\(N_p\)</span> as well. <span class="math display">\[M_{LD}'[x,y]=M_{LD}[x,y] + M_{LD}[x,-y]\]</span></p>
<p><span class="math display">\[N_{LD}'=N_{LD} + N_{RD}\]</span></p></li>
</ol>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This step enforces symmetry between the two positions and sets any action on the <span class="math inline">\(y=0\)</span> line to have zero sway. Now if a player takes two shots at <span class="math inline">\((x,-10)\)</span> and <span class="math inline">\((x,10)\)</span> they will cancel each other out. It has the added benefit of equating the total rates for each action, setting the terms <span class="math inline">\(\sum(\theta_{RD,k} - \theta_{LD,k}) = 0\)</span>. If we were given an event at an undisclosed location it provides no evidence. This is a wanted consequence, as it prevents clustering based on archetypes. For example “stay at home” defenders tend to have high hit and block rates but low shooting rates. The opposite is true for “offensive” defenders.</p>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Apply a Kernel Smoothing Method to each matrix.</li>
</ol>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>To avoid zero frequency problems we add a pseudo count of <span class="math inline">\(\frac{N_p}{N_{\text{base class}}}\)</span> to each count (The fraction preserves a one to one ratio after calculating rates). Afterwards a kernel smoothing method is applied to <span class="math inline">\(M_p'\)</span> to incorporate spatial dependency amongst <span class="math inline">\(\theta\)</span>’s. The main idea here is to apply regularization techniques, commonly found in generalized additive models, while retaining the benefits of our naive bayes classifier, predominantly speed.</p>
<p>At the moment I’ve using a gaussian kernel with <span class="math inline">\(\sigma = 5\)</span> based on visual inspection. A more principled approach, such as selection through cross validation, is left to future work. However, current results have been impartial to alternative choices. I’ve included a viz for <span class="math inline">\(\sigma = 20\)</span> at the bottom of the article. It will be worth looking into adaptive kernels, whose bandwidth fluctuates to accommodate sparse regions of the rink. Recall our log odds formula; our aim isn’t an accurate estimate of each position’s rate, but of the ratio between classes. It is the ratio which dictates the separation of classes. When count data is sparse for either position the estimated ratio can be highly variable and our pseudo count - which in some way influences the results like a prior - may have a stronger than intended effect.</p>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Obtain the rates per 60 minutes by dividing each count by exposure <span class="math inline">\(N_{p}'\)</span></li>
</ol>
</section>
<section id="step-2.-pairwise-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="step-2.-pairwise-comparisons">Step 2. Pairwise Comparisons</h3>
<p>Due to the nature of the problem, whenever two teammates are on the ice we wish to compare them to determine who gets what label. The Bradley-Terry model is a standard approach to model pairwise comparisons. It’s commonly used in sports to model team strength from W-L records. The Davidson model is an extension to incorporate ties. Here we’ll treat winning as being assigned LD while sharing the ice with a RD. A tie refers to both players sharing the same label. The probabilities for each outcome is given as:</p>
<ul>
<li><p><span class="math display">\[ p(i=LD, j=RD) = \frac{e^{\alpha_i}}{e^{\alpha_i}+e^{\alpha_j}+e^{z + .5(\alpha_i+\alpha_j)}}\]</span></p></li>
<li><p><span class="math display">\[ p(i=j) = \frac{e^{z + .5(\alpha_i+\alpha_j)}}{e^{\alpha_i}+e^{\alpha_j}+e^{z + .5(\alpha_i+\alpha_j)}}\]</span></p></li>
<li><p><span class="math display">\[ p(i=RD, j=LD) = \frac{e^{\alpha_j}}{e^{\alpha_i}+e^{\alpha_j}+e^{z + .5(\alpha_i+\alpha_j)}}\]</span></p></li>
</ul>
<p>Where <span class="math inline">\(z \in (-\infty,\infty)\)</span> determines the probability of a tie. We set <span class="math inline">\(z=0\)</span> which seems reasonable enough for our purposes. <span class="math inline">\(\alpha_i\)</span> represents player <span class="math inline">\(i\)</span>’s “strength” or evidence for playing on the left side. The <span class="math inline">\(\alpha\)</span>’s are usually fit to the response data, but for this clustering problem we take them to be the log odds computed previously. <s>I think</s> I’m getting away with this since both the Davidson strength terms and log odds are relative values.</p>
<p>Since pairwise comparisons only occur between teammates and only across one game, we can compartmentalize the labelling process accordinglyy. We find labels <span class="math inline">\(l\)</span> such that log likelihood of our pairwise comparison model weighted by the time each pair spent on the ice is maximized:</p>
<p><span class="math display">\[ \sum_{i&lt;j}\Delta[i,j]*log(p(i=l_i, j=l_j))\]</span></p>
<p>Furthermore, we impose a constraint on <span class="math inline">\(l\)</span> such that the size of the majority can only surpass the minority class by 1. This enforces our expectations of roster construction. The most defenders a team has iced this season is 7; which has 70 possible configurations of LD &amp; RD. This makes brute force is a viable option.</p>
<p>Step 1 and 2 are repeated until the labels converge or capped after a certain number of iterations.</p>
<p><img src="images/d_log_odds_dist.jpg" class="img-fluid"> <em>The histogram for strength terms between left and right defenders.</em></p>
</section>
<section id="incorporating-correlation" class="level3">
<h3 class="anchored" data-anchor-id="incorporating-correlation">Incorporating Correlation</h3>
<p>Event data is like splicing a video stream into snapshots of <em>key</em> action moments. <em>Key</em> moments - which might be less discriminative than the times a player is simply floating around - are rare enough a single game’s worth doesn’t ensure success. The most extreme example being Buffalo’s entire D core registering a single even strength event in (gameId: 2021020566); Boston’s Curtis Lazar was generous enough to hit Casey Fitzgerald. Conversely, events can be misleading. It’s not uncommon for players to have “off” games while their team does not provide enough to mitigate the faulty evidence.</p>
<p>The good news is that we don’t have to restrict ourselves to one game worth of information. It is reasonable to expect that players prefer the same roles throughout the season. Say a pair play 20 games in one orientation, how much evidence do you need to be convinced they swapped roles for the next game? To stay within our framework, I’ve decided to apply a weighted aggregate to feature vectors. Each <span class="math inline">\(x_{i,j} = \sum_{i',j'}w_{i',j'}x_{i,j}\)</span> where <span class="math inline">\(w\)</span> should resemble our intuition of which responses are correlated. This leads to a bevy of options. For example, a weighting can be proportional to the ice time given to the player in each game. This results in players having a constant <span class="math inline">\(\alpha\)</span> throughout the season. It would be equivalent to a set ranking for role priority. Another option is to only weigh in games where the player spends the majority of the time with common linemates. Lines can be determined by a graph constructed from <span class="math inline">\(\delta\)</span>. Let an edge <span class="math inline">\({i,j}\)</span> exist if <span class="math inline">\(\delta[i,j]\)</span> and <span class="math inline">\(\delta[j,i]\)</span> are greater than some threshold. Whittle down the threshold until you like what you see. Then all disconnected components which are triangles form F lines, all arcs form D pairs. For extra measure, restrict labels to avoid conflicts within each component.</p>
<p><img src="images/tor_d_odds_dist.jpg" class="img-fluid"> <em>Histogram of log odds for 4 prominent members of Toronto’s Defence. Notice Morgan Rielly, who I contest played every game as LD strictly due to seniority, has some games suggesting otherwise. His partner for most of the year, TJ Brodie is flexible but indulges in the left side whenever the pair is split.</em></p>
<p>Let’s compare the results Toronto’s defence with and without aggregating. I prefer the latter, which exhibits a cleaner separation at the cost of paving over any edge cases.</p>
<table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th"></td>
<td colspan="2" data-quarto-table-cell-role="th">Single Game Strength</td>
<td colspan="3" data-quarto-table-cell-role="th">Season Strength Aggregate</td>
<td colspan="2" data-quarto-table-cell-role="th">Linemate Strength Aggregate</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Name</td>
<td data-quarto-table-cell-role="th">LD</td>
<td data-quarto-table-cell-role="th">RD</td>
<td data-quarto-table-cell-role="th">α</td>
<td data-quarto-table-cell-role="th">LD</td>
<td data-quarto-table-cell-role="th">RD</td>
<td data-quarto-table-cell-role="th">LD</td>
<td data-quarto-table-cell-role="th">RD</td>
</tr>
<tr class="odd">
<td>Jake Muzzin</td>
<td>47</td>
<td>0</td>
<td>3.57</td>
<td>47</td>
<td>0</td>
<td>47</td>
<td>0</td>
</tr>
<tr class="even">
<td>Kristians Rubins</td>
<td>3</td>
<td>0</td>
<td>3.3</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Mark Giordano</td>
<td>19</td>
<td>1</td>
<td>2.97</td>
<td>20</td>
<td>0</td>
<td>19</td>
<td>1</td>
</tr>
<tr class="even">
<td>Morgan Rielly</td>
<td>76</td>
<td>6</td>
<td>2.32</td>
<td>82</td>
<td>0</td>
<td>82</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Carl Dahlstrom</td>
<td>3</td>
<td>0</td>
<td>2.07</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>0</td>
</tr>
<tr class="even">
<td>Rasmus Sandin</td>
<td>43</td>
<td>8</td>
<td>1.25</td>
<td>49</td>
<td>2</td>
<td>49</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Travis Dermott</td>
<td>23</td>
<td>20</td>
<td>0.32</td>
<td>19</td>
<td>24</td>
<td>20</td>
<td>23</td>
</tr>
<tr class="even">
<td>TJ Brodie</td>
<td>28</td>
<td>54</td>
<td>0.31</td>
<td>23</td>
<td>59</td>
<td>23</td>
<td>59</td>
</tr>
<tr class="odd">
<td>Ilya Lyubushkin</td>
<td>2</td>
<td>29</td>
<td>-1.47</td>
<td>0</td>
<td>31</td>
<td>1</td>
<td>30</td>
</tr>
<tr class="even">
<td>Timothy Liljegren</td>
<td>3</td>
<td>58</td>
<td>-2.08</td>
<td>0</td>
<td>61</td>
<td>0</td>
<td>61</td>
</tr>
<tr class="odd">
<td>Justin Holl</td>
<td>0</td>
<td>69</td>
<td>-2.85</td>
<td>0</td>
<td>69</td>
<td>0</td>
<td>69</td>
</tr>
<tr class="even">
<td>Alex Biega</td>
<td>0</td>
<td>2</td>
<td>-3.84</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>2</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="centers-vs.-wingers" class="level2">
<h2 class="anchored" data-anchor-id="centers-vs.-wingers">Centers vs.&nbsp;Wingers</h2>
<p>Some slight adjustments are made to accommodate forwards. At each pass of the algorithm forwards are clustered into center and winger groups, then wingers into left and right. LW and RW labels are assigned similarly to defenders. Separating out centers is a bit different and we detail the changes below.</p>
<ul>
<li><p>Faceoffs are included, but since they only occur in 9 locations we do not apply any KDE, though there is merit to jacking up the pseudo count to balance its effect against the other smoothed over actions.</p></li>
<li><p>When reflecting the counts, mirror center counts onto themselves.</p></li>
<li><p>Normalize the count rates for each action except Faceoffs. Essentially this creates a debt which centers can easily work out of by taking faceoffs. Thus if no actions are taken, the player is more likely to be a winger.</p></li>
<li><p>Calculate the log odds between center and the two winger classes as:</p></li>
</ul>
<p><span class="math display">\[\begin{aligned}
\beta_{i,j} &amp;= log \frac{f(C | x_{i,j})}{f(LW | x_{i,j})+f(RW | x_{i,j})} \\
&amp;= log\frac{\prod e^{-n_{i,j}\theta_{C,k}}(n_{i,j}\theta_{C,k})^{x_ijk}}{\prod e^{-n_{i,j}\theta_{LW,k}}(n_{i,j}\theta_{LW,k})^{x_ijk} + \prod e^{-n_{i,j}\theta_{RW,k}}(n_{i,j}\theta_{RW,k})^{x_ijk}}\\
&amp;= \sum x_{ijk}log \theta_{C,k} - n_{i,j} \sum\theta_{C,k} - log (\prod e^{-n_{i,j}\theta_{LW,k}}\theta_{LW,k}^{x_ijk} + \prod e^{-n_{i,j}\theta_{RW,k}}\theta_{RW,k}^{x_ijk})\\
&amp;= \sum x_{ijk}log \theta_{C,k} - n_{i,j} \sum\theta_{C,k} - log (\prod e^{-n_{i,j}\theta_{LW,k}}(\prod\theta_{LW,k}^{x_ijk} + \prod\theta_{RW,k}^{x_ijk}))\\
&amp;= \sum x_{ijk}log \theta_{C,k} - n_{i,j} \sum(\theta_{C,\text{Faceoffs}} - \theta_{LW,\text{Faceoffs}}) - log (e^{\sum x_{ijk}log \theta_{LW,k}} + e^{\sum x_{ijk}log \theta_{RW,k}})\\
\end{aligned}
\]</span></p>
<ul>
<li><p>Calculate the log likelihood using the Davidson-Luce Model for groupwise comparisons [1]. Compare every combination of three forwards. Once again weigh by shared ice time. Limit the amount of C labels assigned in one game between <span class="math inline">\(\lfloor \frac{\text{\# of forwards}}{3}\rfloor\)</span> and <span class="math inline">\(\lceil \frac{\text{\# of forwards}}{3}\rceil\)</span>.</p>
<ul>
<li><span class="math display">\[ p(l_i=C, l_j=W, l_k=W) \propto e^{\beta_i}\]</span></li>
<li><span class="math display">\[ p(l_i=W, l_j=C, l_k=W) \propto e^{\beta_j}\]</span></li>
<li><span class="math display">\[ p(l_i=W, l_j=W, l_k=C) \propto e^{\beta_k}\]</span></li>
<li><span class="math display">\[ p(l_i=C, l_j=C, l_k=W) \propto e^{z_2 + \frac{1}{2}(\beta_i + \beta_j)}\]</span></li>
<li><span class="math display">\[ p(l_i=C, l_j=W, l_k=C) \propto e^{z_2 + \frac{1}{2}(\beta_i + \beta_k)}\]</span></li>
<li><span class="math display">\[ p(l_i=W, l_j=C, l_k=C) \propto e^{z_2 + \frac{1}{2}(\beta_j + \beta_k)}\]</span></li>
<li><span class="math display">\[ p(l_i=W, l_j=W, l_k=W) \propto e^{z_3 + \frac{1}{3}(\beta_i + \beta_j + \beta_k)}\]</span></li>
<li><span class="math display">\[ p(l_i=C, l_j=C, l_k=C) \propto e^{z_3 + \frac{1}{3}(\beta_i + \beta_j + \beta_k)}\]</span></li>
</ul></li>
</ul>
<p><img src="images/c_log_odds_dist.jpg" class="img-fluid"> <em>The histogram for log odds between center and winger. The mixture clearly exhibits two components, it’s easy to spot the pretenders immediately. The final distribution for centers is wide due to the weight of faceoffs. Modelling faceoff rates as a poisson distribution may not be the best choice, since coaches try to allocate them based on preference.</em></p>
<p><img src="images/w_log_odds_dist.jpg" class="img-fluid"> <em>The histogram for log odds between left and right wingers, a sad site.</em></p>
<p>Once again, let’s look at the results for Toronto. The winger labels are suspect until we aggregate games. Season and linemate weightings tend to agree. When they do not, manual inspection typically favours the latter when the line has played plenty of games together.</p>
<table data-quarto-postprocess="true" class="table">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th"></td>
<td colspan="3" data-quarto-table-cell-role="th">Single Game Strength</td>
<td colspan="5" data-quarto-table-cell-role="th">Season Strength Aggregrate</td>
<td colspan="3" data-quarto-table-cell-role="th">Linemate Strength Aggregrate</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Name</td>
<td data-quarto-table-cell-role="th">C</td>
<td data-quarto-table-cell-role="th">LW</td>
<td data-quarto-table-cell-role="th">RW</td>
<td data-quarto-table-cell-role="th">Β</td>
<td data-quarto-table-cell-role="th">α</td>
<td data-quarto-table-cell-role="th">C</td>
<td data-quarto-table-cell-role="th">LW</td>
<td data-quarto-table-cell-role="th">RW</td>
<td data-quarto-table-cell-role="th">C</td>
<td data-quarto-table-cell-role="th">LW</td>
<td data-quarto-table-cell-role="th">RW</td>
</tr>
<tr class="odd">
<td>Auston Matthews</td>
<td>73</td>
<td>0</td>
<td>0</td>
<td>27.57</td>
<td>2.47</td>
<td>73</td>
<td>0</td>
<td>0</td>
<td>73</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>John Tavares</td>
<td>79</td>
<td>0</td>
<td>0</td>
<td>22.8</td>
<td>1.01</td>
<td>79</td>
<td>0</td>
<td>0</td>
<td>79</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>David Kampf</td>
<td>82</td>
<td>0</td>
<td>0</td>
<td>19.31</td>
<td>0.95</td>
<td>82</td>
<td>0</td>
<td>0</td>
<td>82</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Jason Spezza</td>
<td>61</td>
<td>1</td>
<td>9</td>
<td>9.54</td>
<td>-2.61</td>
<td>70</td>
<td>0</td>
<td>1</td>
<td>62</td>
<td>3</td>
<td>6</td>
</tr>
<tr class="odd">
<td>Brett Seney</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0.55</td>
<td>1.72</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Colin Blackwell</td>
<td>11</td>
<td>0</td>
<td>8</td>
<td>-3.1</td>
<td>-1.58</td>
<td>5</td>
<td>0</td>
<td>14</td>
<td>9</td>
<td>0</td>
<td>10</td>
</tr>
<tr class="odd">
<td>Nicholas Abruzzese</td>
<td>1</td>
<td>5</td>
<td>3</td>
<td>-4.95</td>
<td>0.03</td>
<td>1</td>
<td>7</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>2</td>
</tr>
<tr class="even">
<td>Kirill Semyonov</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>-5.77</td>
<td>0.28</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Alexander Kerfoot</td>
<td>12</td>
<td>53</td>
<td>17</td>
<td>-6.24</td>
<td>0.7</td>
<td>10</td>
<td>72</td>
<td>0</td>
<td>12</td>
<td>54</td>
<td>16</td>
</tr>
<tr class="even">
<td>Alex Steeves</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>-6.31</td>
<td>-0.27</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Michael Amadio</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>-6.35</td>
<td>-0.99</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>0</td>
</tr>
<tr class="even">
<td>Kyle Clifford</td>
<td>1</td>
<td>15</td>
<td>7</td>
<td>-6.73</td>
<td>0.22</td>
<td>3</td>
<td>15</td>
<td>5</td>
<td>1</td>
<td>19</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Wayne Simmonds</td>
<td>0</td>
<td>31</td>
<td>41</td>
<td>-7.51</td>
<td>-0.23</td>
<td>1</td>
<td>11</td>
<td>60</td>
<td>0</td>
<td>9</td>
<td>63</td>
</tr>
<tr class="even">
<td>Pierre Engvall</td>
<td>4</td>
<td>43</td>
<td>31</td>
<td>-7.94</td>
<td>0.17</td>
<td>0</td>
<td>59</td>
<td>19</td>
<td>4</td>
<td>44</td>
<td>30</td>
</tr>
<tr class="odd">
<td>Nicholas Robertson</td>
<td>0</td>
<td>7</td>
<td>3</td>
<td>-7.99</td>
<td>-0.04</td>
<td>0</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>9</td>
<td>1</td>
</tr>
<tr class="even">
<td>Joey Anderson</td>
<td>0</td>
<td>1</td>
<td>4</td>
<td>-8.13</td>
<td>-0.19</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>5</td>
</tr>
<tr class="odd">
<td>Nick Ritchie</td>
<td>0</td>
<td>25</td>
<td>8</td>
<td>-8.94</td>
<td>0.48</td>
<td>0</td>
<td>33</td>
<td>0</td>
<td>0</td>
<td>33</td>
<td>0</td>
</tr>
<tr class="even">
<td>Ondrej Kase</td>
<td>0</td>
<td>11</td>
<td>39</td>
<td>-9.21</td>
<td>-0.41</td>
<td>0</td>
<td>3</td>
<td>47</td>
<td>0</td>
<td>2</td>
<td>48</td>
</tr>
<tr class="odd">
<td>William Nylander</td>
<td>1</td>
<td>26</td>
<td>54</td>
<td>-9.34</td>
<td>-0.54</td>
<td>0</td>
<td>0</td>
<td>81</td>
<td>1</td>
<td>16</td>
<td>64</td>
</tr>
<tr class="even">
<td>Ilya Mikheyev</td>
<td>0</td>
<td>35</td>
<td>18</td>
<td>-9.82</td>
<td>0.25</td>
<td>0</td>
<td>38</td>
<td>15</td>
<td>0</td>
<td>52</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Michael Bunting</td>
<td>0</td>
<td>51</td>
<td>28</td>
<td>-10.72</td>
<td>0.21</td>
<td>0</td>
<td>77</td>
<td>2</td>
<td>0</td>
<td>76</td>
<td>3</td>
</tr>
<tr class="even">
<td>Mitchell Marner</td>
<td>0</td>
<td>21</td>
<td>51</td>
<td>-11.3</td>
<td>-0.18</td>
<td>0</td>
<td>1</td>
<td>71</td>
<td>0</td>
<td>0</td>
<td>72</td>
</tr>
</tbody>
</table>
<p>As for the entire league, 36229 out of 47208 come to a concensus for all three options. The remaining conflicts are resolved in the following manner. First by majority vote, then by sorting out the remaining labels for each game and team with the single game strength terms.</p>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding Remarks</h2>
<p>There remains a lot to be tinkered with. Adding penalties, separating wrap-arounds or other secondary types from shots, partitioning the rink’s grid by zone before smoothing, possibly some more denoising… I suspect most to be fruitless. The main sticking point is distilling winger labels. Diminishing the additive smoothing or pushing the KDE to produce more discriminative ratios leads to similar yet murky results. Forwards tend to cross over the <span class="math inline">\(y = 0\)</span> line enough to require more spatial sampling for consistency. The only way I’ve found to overcome this is by feeding season data into the single game strength terms, in perhaps the most unprincipled manner (please feel free to lecture me on my bad behaviour). I subsist this provides close to ideal results without manual inspection. It seems adequate if your goal is to get positional eligibility status for fantasy hockey. Keep scrolling down for results.</p>
<p>You can reach me on twitter at yimmymcbill if you have suggestions, there is certainly room for improvement!</p>
<p>I’ve provided a summary for each team in the links below.</p>
<p><a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/24-roster_positions.jpg">Anaheim Ducks</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/53-roster_positions.jpg">Arizona Coyotes</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/6-roster_positions.jpg">Boston Bruins</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/7-roster_positions.jpg">Buffalo Sabres</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/20-roster_positions.jpg">Calgary Flames</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/12-roster_positions.jpg">Carolina Hurricanes</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/16-roster_positions.jpg">Chicago Blackhawks</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/21-roster_positions.jpg">Colorado Avalanche</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/29-roster_positions.jpg">Columbus Blue Jackets</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/25-roster_positions.jpg">Dallas Stars</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/17-roster_positions.jpg">Detroit Red Wings</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/22-roster_positions.jpg">Edmonton Oilers</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/13-roster_positions.jpg">Florida Panthers</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/26-roster_positions.jpg">Los Angeles Kings</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/30-roster_positions.jpg">Minnesota Wild</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/8-roster_positions.jpg">Montréal Canadiens</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/18-roster_positions.jpg">Nashville Predators</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/1-roster_positions.jpg">New Jersey Devils</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/2-roster_positions.jpg">New York Islanders</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/3-roster_positions.jpg">New York Rangers</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/9-roster_positions.jpg">Ottawa Senators</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/4-roster_positions.jpg">Philadelphia Flyers</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/5-roster_positions.jpg">Pittsburgh Penguins</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/28-roster_positions.jpg">San Jose Sharks</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/55-roster_positions.jpg">Seattle Kraken</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/19-roster_positions.jpg">St.&nbsp;Louis Blues</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/14-roster_positions.jpg">Tampa Bay Lightning</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/10-roster_positions.jpg">Toronto Maple Leafs</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/23-roster_positions.jpg">Vancouver Canucks</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/54-roster_positions.jpg">Vegas Golden Knights</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/15-roster_positions.jpg">Washington Capitals</a> <a href="https://drydan.github.io/posts-hockey/player-positions/2021_rosters/52-roster_positions.jpg">Winnipeg Jets</a></p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>[1] Firth, D., Kosmidis, I., &amp; Turner, H. (2019). Davidson-Luce model for multi-item choice with ties. arXiv preprint arXiv:1909.07123.</p>
<section id="defender-results" class="level3">
<h3 class="anchored" data-anchor-id="defender-results">Defender Results</h3>
<p><img src="images/d_log_heatmaps.jpg" class="img-fluid"> <em>The final estimates for the coefficient-like terms for the event counts in the posterior odds ratio formula. The log of the LD over RD rate parameters.</em></p>
<p><img src="images/d_heatmaps.jpg" class="img-fluid"> <em>The final Rates per sixty minutes for left and right defenders</em></p>
</section>
<section id="forward-results" class="level3">
<h3 class="anchored" data-anchor-id="forward-results">Forward Results</h3>
<p><img src="images/f_log_heatmaps.jpg" class="img-fluid"> <em>The final estimates for the coefficient-like terms for the event counts in the posterior odds ratio formula between two of the three forward positions.</em></p>
<p><img src="images/f_log_heatmaps_high_sig.jpg" class="img-fluid"> <em>An example using Gaussian KDE with <span class="math inline">\(\sigma\)</span> cranking up to 20.</em></p>
<p><img src="images/f_heatmaps.jpg" class="img-fluid"> <em>The final Rates per sixty minutes for all forward positions</em></p>
<p><img src="images/final_faceoff_rates.jpg" class="img-fluid"></p>
</section>
</section>
<section id="forwards-labelled-as-defenders" class="level2">
<h2 class="anchored" data-anchor-id="forwards-labelled-as-defenders">Forwards Labelled as Defenders</h2>
<table class="table">
<colgroup>
<col style="width: 36%">
<col style="width: 36%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>playerId</th>
<th>fullName</th>
<th>gameId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>8474145</td>
<td>Robert Bortuzzo</td>
<td>2021020311</td>
</tr>
<tr class="even">
<td>8474722</td>
<td>Luke Witkowski</td>
<td>2021020939</td>
</tr>
<tr class="odd">
<td>8475625</td>
<td>Matt Irwin</td>
<td>2021020469</td>
</tr>
<tr class="even">
<td>8476372</td>
<td>Nick Seeler</td>
<td>2021020739</td>
</tr>
<tr class="odd">
<td>8476470</td>
<td>Nathan Beaulieu</td>
<td>2021020314</td>
</tr>
<tr class="even">
<td>8476779</td>
<td>Brad Hunt</td>
<td>2021021152</td>
</tr>
<tr class="odd">
<td>8477073</td>
<td>Kurtis MacDermid</td>
<td>2021020299, 2021020321, 2021020399, 2021020415, 2021020433, 2021020490, 2021020580, 2021020591, 2021020606, 2021020622, 2021020634, 2021020641, 2021020663, 2021020805, 2021020826, 2021020836, 2021020857, 2021020871, 2021020886, 2021020962, 2021020982, 2021021119</td>
</tr>
<tr class="even">
<td>8477335</td>
<td>Kyle Burroughs</td>
<td>2021021175, 2021021192</td>
</tr>
<tr class="odd">
<td>8477419</td>
<td>Mason Geertsen</td>
<td>2021020043, 2021020056, 2021020090, 2021020226, 2021020327, 2021020360, 2021020422, 2021020529, 2021020586, 2021020631, 2021020666, 2021020817, 2021020875, 2021020904, 2021020921, 2021020935, 2021020966, 2021020989, 2021021005, 2021021074, 2021021274</td>
</tr>
<tr class="even">
<td>8477851</td>
<td>Jordan Oesterle</td>
<td>2021020472, 2021021101, 2021021222, 2021021235</td>
</tr>
<tr class="odd">
<td>8477938</td>
<td>Haydn Fleury</td>
<td>2021020967</td>
</tr>
<tr class="even">
<td>8478013</td>
<td>Jake Walman</td>
<td>2021020394, 2021020547</td>
</tr>
<tr class="odd">
<td>8478017</td>
<td>Mark Friedman</td>
<td>2021021029</td>
</tr>
<tr class="even">
<td>8479372</td>
<td>Josh Mahura</td>
<td>2021020907</td>
</tr>
<tr class="odd">
<td>8479376</td>
<td>Victor Mete</td>
<td>2021021199</td>
</tr>
<tr class="even">
<td>8479439</td>
<td>Jacob MacDonald</td>
<td>2021020105, 2021020122, 2021020145</td>
</tr>
<tr class="odd">
<td>8479639</td>
<td>Dylan Coghlan</td>
<td>2021021073, 2021021126</td>
</tr>
<tr class="even">
<td>8480160</td>
<td>Radim Simek</td>
<td>2021021171</td>
</tr>
<tr class="odd">
<td>8480884</td>
<td>Calen Addison</td>
<td>2021020344, 2021020599</td>
</tr>
<tr class="even">
<td>8481003</td>
<td>Hunter Drew</td>
<td>2021021285, 2021021307</td>
</tr>
<tr class="odd">
<td>8482624</td>
<td>Daniil Miromanov</td>
<td>2021020100</td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>